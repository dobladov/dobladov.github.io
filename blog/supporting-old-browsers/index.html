<!DOCTYPE html><html lang="en" data-astro-cid-colb5upu> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" href="/orb512.png"><meta name="generator" content="Astro v5.16.5"><link rel="manifest" href="/manifest.webmanifest"><meta http-equiv="content-language" content="en"><link rel="alternate" type="application/rss+xml" title="RSS feed" href="/rss.xml"><link rel="alternate" type="application/feed+json" title="JSON feed" href="/feed.json"><!-- Canonical URL --><link rel="canonical" href="https://dobla.do/blog/supporting-old-browsers/"><link rel="sitemap" href="/sitemap-index.xml"><!-- Primary Meta Tags --><title>Supporting old browsers - Daniel Doblado</title><meta name="title" content="Supporting old browsers"><meta name="description" content="The process of debugging and supporting an old iOS browser"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://dobla.do/blog/supporting-old-browsers/"><meta property="og:title" content="Supporting old browsers"><meta property="og:description" content="The process of debugging and supporting an old iOS browser"><meta property="og:image" content="https://dobla.do/orb512.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://dobla.do/blog/supporting-old-browsers/"><meta property="twitter:title" content="Supporting old browsers"><meta property="twitter:description" content="The process of debugging and supporting an old iOS browser"><meta property="twitter:image" content="https://dobla.do/orb512.png"><!-- Mastodon --><meta name="fediverse:creator" content="@danieldobla@mastodon.social"><script type="module">document.body.removeAttribute("data-js");</script><style>article{margin:0 auto;max-width:46rem}article p{margin-bottom:2em}@media screen and (min-width:468px){article{margin-top:2rem}}.toArticle{position:fixed;top:-100%;left:50%;transform:translate(-50%);transition:top .3s ease-in-out;padding:0 1rem}.toArticle:focus{top:1%}#title{text-align:left}.date{text-align:right;font-style:italic}.description{font-size:2rem;line-height:110%;text-align:center}@keyframes adjust-progressbar{0%{height:0}to{height:100%}}aside:before,aside:after{content:"";position:absolute;top:0;left:0;width:.25rem;height:100%;background:var(--text);border-radius:.25rem}@supports (animation-timeline: scroll(block root)){aside:after{background:var(--accent);animation:adjust-progressbar;animation-timeline:scroll(block root);animation-duration:auto}}aside{display:none;position:fixed;left:1rem;top:50%;max-width:15rem;transform:translateY(-50%);max-height:50vh;padding-left:1rem;padding-right:1rem}aside ul{list-style:none;margin:0;padding:0}aside a{text-overflow:ellipsis;display:inline-block;text-decoration:none;transition:transform .2s ease-out;transform-origin:left;line-height:1;padding-bottom:.5rem;color:var(--text)}aside a.active{color:var(--accent)}aside a:hover{transform:scale(1.1);color:var(--accent)}pre{margin-bottom:2rem}@media screen and (min-width:992px){img,pre{--space: 8rem;width:calc(100% + var(--space));position:relative;left:calc(var(--space) / -2);max-width:calc(100% + var(--space))!important}#title{--space: 5rem;width:calc(100% + var(--space));position:relative;left:calc(var(--space) / -2);font-size:4rem}}@media screen and (min-width:1300px){aside{display:block}}summary{cursor:pointer}.details{font-family:Courier New,monospace;padding-top:1rem}#metadata{display:flex;flex-direction:column;justify-content:space-between;font-size:.8rem}.tags{display:flex;flex-wrap:wrap;column-gap:.5rem;justify-content:flex-end}.metaSection{gap:1.5rem;display:flex;justify-content:space-between;border-top:1px solid var(--text);padding-top:.2rem;padding-bottom:.2rem}.centered{padding-top:1rem}.correctLink{margin-top:1.5rem}@media print{article{max-width:210mm;width:210mm}.toArticle,.date,.correctLink,details{display:none}}
</style>
<link rel="stylesheet" href="/_astro/_slug_.CTIEadp6.css">
<style>.separator[data-astro-cid-jchhmuzl]{color:var(--link)}
</style></head> <body data-js="false" data-astro-cid-colb5upu> <a class="toArticle" href="#article">To the article</a> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <h1 data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2>Daniel Doblado</a> </h1> <div class="internalLinks" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/projects" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Projects </a>  <a href="/tags" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Tags </a>  <a href="/rss.xml" class="rss" title="RSS" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg>  <svg width="1.01em" height="1em" data-astro-cid-3ef6ksr2="true" data-icon="rss">   <symbol id="ai:local:rss" viewBox="0 0 82.459 82.347"><g fill="currentColor" transform="translate(-10.112 -9.668)"><circle cx="21.243" cy="80.884" r="11.131"/><path d="M18.229 40.126a7.626 7.626 0 1 0 0 15.253c15.917 0 28.865 12.95 28.865 28.865a7.626 7.626 0 0 0 7.628 7.627 7.627 7.627 0 0 0 7.627-7.627c0-24.326-19.793-44.118-44.12-44.118"/><path d="M17.997 9.668a7.628 7.628 0 0 0 0 15.254c32.708.001 59.32 26.613 59.32 59.322a7.627 7.627 0 1 0 15.254 0c0-41.118-33.453-74.573-74.574-74.576"/></g></symbol><use href="#ai:local:rss"></use>  </svg>  </a>  <!-- <ThemeToggle /> --> </div> </nav> <svg style="width: 0; height: 0" xmlns="http://www.w3.org/2000/svg" version="1.1" data-astro-cid-3ef6ksr2> <defs data-astro-cid-3ef6ksr2> <filter id="goovey" data-astro-cid-3ef6ksr2> <feTurbulence type="fractalNoise" baseFrequency="0.03" numOctaves="1" result="warpper" data-astro-cid-3ef6ksr2></feTurbulence> <feColorMatrix in="warpper" type="hueRotate" data-astro-cid-3ef6ksr2> <animate attributeType="XML" attributeName="values" values="0;110;150;210;360" dur="6s" repeatCount="indefinite" data-astro-cid-3ef6ksr2></animate> </feColorMatrix> <feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="20" in="SourceGraphic" data-astro-cid-3ef6ksr2></feDisplacementMap> </filter> </defs> </svg> <div class="pattern" data-astro-cid-pj7xj6mf></div> </header> <main data-astro-cid-colb5upu> <section data-astro-cid-colb5upu>   <article id="article"> <header> <h1 id="title">Supporting old browsers</h1> <div class="date"> 5 min read<span class="separator" data-astro-cid-jchhmuzl>&nbsp;·&nbsp;</span><time datetime="2025-01-07T00:00:00.000Z"> Jan 7, 2025 </time>  </div> </header> <aside> <ul> <li> <a title="Navigate to the start of the article" href="#title">Start</a> </li> <li> <a href="#the-problem">The problem</a> </li><li> <a href="#identifying-the-parse-error">Identifying the parse error</a> </li><li> <a href="#fixing-the-code">Fixing the code</a> </li><li> <a href="#conclusion">Conclusion</a> </li> <li> <a id="metadataLink" title="Navigate to the end of the article" href="#metadata">Metadata</a> </li> </ul> </aside> <p class="description"> The process of debugging and supporting an old iOS browser </p>  <h2 id="the-problem">The problem<a aria-hidden="true" tabindex="-1" href="#the-problem"><span class="icon icon-link"></span></a></h2>
<p>I reached a point at work where I have to support old iOS versions, and by old I mean iOS 13, which at the moment of writing this post is 5 years old. If you have to ask me, this is a waste of resources for a very small amount of users and while I made this point clear, this is my job, and it has to be done.</p>
<p>So now on, each release and each upgrade of packages will require testing on devices that even the manufacturers themselves don’t care about anymore. Even worse, we have to keep devices that could be upgraded to another major version locked in old versions.</p>
<p>The device I’m using right now is an <em>iPhone 8</em> running <code>iOS 13.5.1</code> which is upgradable at least to version <code>16</code>, a device released in 2017 and not supported anymore by Apple.</p>
<h2 id="identifying-the-parse-error">Identifying the parse error<a aria-hidden="true" tabindex="-1" href="#identifying-the-parse-error"><span class="icon icon-link"></span></a></h2>
<p>After upgrading to <code>react-redux@9.2.0</code> this old phone is incapable of parsing the bundle, with a very unhelpful message, even with source maps.</p>
<p><img alt="Screenshot 2025-01-07 at 11.45.53.png" loading="lazy" decoding="async" fetchpriority="auto" width="1410" height="194" src="/_astro/parse-error.lQ27K4JF_ZKMJlt.webp" ></p>
<p>We know that some token can’t be read causing the whole app to crash, meaning that one character in the bundle is code that was not supported in this version of iOS. How do we find the precise code?</p>
<p>In this case, I was able to narrow it to the packages updated. If this was not possible, let’s say an existing codebase would need to be adapted to work on old devices, some other debug can be added like including comments with the name of the modules imported to see where it breaks.</p>
<p><img alt="Screenshot 2025-01-07 at 12.58.51.png" loading="lazy" decoding="async" fetchpriority="auto" width="3316" height="1226" src="/_astro/debug-with-module.DhknPoxt_Zdq65l.webp" ></p>
<p>Getting closer but how do we know the precise line of code? Bundling in this case removed all the information. Once I knew that <code>./node_modules/react-redux/dist/react-redux.mjs</code> was the real issue, the next step was to recreate it on a smaller setup.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">&#x3C;!</span><span style="color:#85E89D">DOCTYPE</span><span style="color:#B392F0"> html</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">html</span><span style="color:#B392F0"> lang</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"en"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">head</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">meta</span><span style="color:#B392F0"> charset</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"UTF-8"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">meta</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"viewport"</span><span style="color:#B392F0"> content</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"width=device-width, initial-scale=1.0"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">title</span><span style="color:#E1E4E8">>Document&#x3C;/</span><span style="color:#85E89D">title</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">head</span><span style="color:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">body</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    Debugging react-redux on iOS 13</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">script</span><span style="color:#B392F0"> type</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"module"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">        import</span><span style="color:#9ECBFF"> './react-redux.mjs'</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">body</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">html</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>Once serving this file and accessing it from the device, the error was much more clear, I could see the line causing the issue.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> contextMap</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> gT[ContextKey] </span><span style="color:#F97583">??=</span><span style="color:#6A737D"> /* @__PURE__ */</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map</span><span style="color:#E1E4E8">();</span></span></code></pre>
<p>In this case, the operator <code>??=</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_assignment" rel="nofollow" target="_blank">Nullish coalescing assignment</a> was not supported at this version of iOS: <a href="https://caniuse.com/?search=Nullish%20coalescing%20assignment" rel="nofollow" target="_blank">Can I use Search
Nullish coalescing assignment ?</a></p>
<h2 id="fixing-the-code">Fixing the code<a aria-hidden="true" tabindex="-1" href="#fixing-the-code"><span class="icon icon-link"></span></a></h2>
<h3 id="manual-patching">Manual Patching<a aria-hidden="true" tabindex="-1" href="#manual-patching"><span class="icon icon-link"></span></a></h3>
<p>There are various routes to get the problem solved, a simple one would be to patch the library in <code>node_modules</code>. Initially, I did it manually to make sure that was the solution for running <code>react-redux</code> on the device simply changing the line of code for:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#6A737D">//const contextMap = gT[ContextKey] ??= /* @__PURE__ */ new Map();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> contextMap</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> gT[ContextKey] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> gT[ContextKey] </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> undefined</span><span style="color:#F97583"> ||</span><span style="color:#E1E4E8"> gT[ContextKey] </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#F97583">  ?</span><span style="color:#6A737D"> /* @__PURE__ */</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map</span><span style="color:#E1E4E8">() </span></span>
<span class="line"><span style="color:#F97583">  :</span><span style="color:#E1E4E8"> gT[ContextKey];</span></span></code></pre>
<p>The patch can be more <em>permanent</em> using <code>npx patch-package</code>: <a href="https://stackoverflow.com/questions/72820625/what-is-the-proper-way-to-patch-a-node-modules-module/77385111#77385111" rel="nofollow" target="_blank">Stack overflow - Patch a “node_modules” (Node.js) module</a></p>
<p>This could be a good hotfix, but we want it fixed for future cases.</p>
<h3 id="creating-a-pull-request">Creating a pull request<a aria-hidden="true" tabindex="-1" href="#creating-a-pull-request"><span class="icon icon-link"></span></a></h3>
<p>Second solution, to create a PR in the <code>react-redux</code> project and use less modern JavaScript, this solution is far from ideal. I don’t like to write older code, we should look at the future and while it does make the library more compatible I would have to justify and convince them to merge it, so I decided not to do it.</p>
<p><a href="https://github.com/reduxjs/react-redux/blob/7e2fdd4ee2021e4282e12ba9fc722f09124e30cd/src/components/Context.ts#L31" rel="nofollow" target="_blank">Line of code to change</a></p>
<h3 id="babel-plugins">Babel plugins<a aria-hidden="true" tabindex="-1" href="#babel-plugins"><span class="icon icon-link"></span></a></h3>
<p>Third solution, transpile the library using <a href="https://babeljs.io/" rel="nofollow" target="_blank">Babel</a> to more widely supported JavaScript automatically using plugins, and here is where the issue got more confusing. The project already used Babel to do exactly this, in fact <code>@babel/preset-env</code> includes the two plugins that are required to make the failing file work <a href="https://babeljs.io/docs/babel-plugin-transform-nullish-coalescing-operator" rel="nofollow" target="_blank">@babel/plugin-transform-nullish-coalescing-operator</a> and <a href="https://babeljs.io/docs/babel-plugin-transform-logical-assignment-operators" rel="nofollow" target="_blank">@babel/plugin-transform-logical-assignment-operators</a>, but somehow after a build the file ended intact and still containing <code>??=</code>.</p>
<p>So what was happening? We had to transpile <code>react-redux</code> in the past to support other issues, as I could see in the webpack file <code>resolve(__dirname, 'node_modules/react-redux')</code> was in the <code>include</code> for <code>babel-loader</code>.</p>
<p>Well, the newer version of the package uses JS modules, and now the extension of the file was <code>.mjs</code> instead of <code>.js</code> meaning that the regex to match the files was completely ignoring the file <code>/\.(js|jsx)$/</code>. After simply adding <code>/\.(js|jsx|mjs)$/</code> the file was correctly parsed and worked on iOS 13.</p>
<h2 id="conclusion">Conclusion<a aria-hidden="true" tabindex="-1" href="#conclusion"><span class="icon icon-link"></span></a></h2>
<p>It’s important to understand how other people’s code end up in your build. In this case, I learned how to better debug third-party code with Safari which is not fun, how to adapt code to work in devices that were not supposed to work with it, and how to make sure that the code is transpiled correctly.</p>
<p>I hope this post helps someone in the future, at the very least was useful for a small subset of users that still use old devices.</p>
<p><img alt="Abstract illustration of an old browser" loading="lazy" decoding="async" fetchpriority="auto" width="864" height="633" src="/_astro/glitched-browser.DKOJtSjQ_ZlL2uj.webp" ></p>  <!-- <Share title={title} description={description} url={href} /> --> <details class="details"> <summary>Metadata</summary> <div id="metadata"> <div class="metaSection"> <span class="title">Published</span> <time datetime="2025-01-07T00:00:00.000Z"> Jan 7, 2025 </time> </div>  <div class="metaSection"> <span class="title">Length</span> <span>5 min read (804 words)</span> </div> <div class="metaSection"> <span class="title">License</span> <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> </div> <div class="metaSection"> <span class="title">Tags</span> <div class="tags">  <a href="/tags/maintenance">#maintenance </a>  <a href="/tags/javascript">#javascript </a>  <a href="/tags/ios">#ios </a>  <a href="/tags/babel">#babel </a>  <a href="/tags/redux">#redux </a>  <a href="/tags/debugging">#debugging</a>  </div> </div> <div class="centered"> <a class="correctLink" target="_blank" href="https://github.com/dobladov/astro-blog/edit/main/src/content/blog/supporting-old-browsers/index.md">Did I make a mistake? Please consider sending a pull request</a> </div> <script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Supporting old browsers","editor":"Daniel Doblado","genre":"maintenance javascript ios babel redux debugging","keywords":"maintenance javascript ios babel redux debugging","wordcount":804,"url":"https://dobla.do/blog/supporting-old-browsers/","datePublished":"2025-01-07T00:00:00.000Z","dateCreated":"2025-01-07T00:00:00.000Z","description":"The process of debugging and supporting an old iOS browser","author":{"url":"https://dobla.do","@type":"Person","name":"Daniel Doblado"}}</script> </div> </details> <div class="progress"></div> </article>  </section> </main> <footer data-astro-cid-sz7xmlte> <a target="_blank" href="https://codepen.io/dobladov" data-astro-cid-sz7xmlte>CodePen</a> <a target="_blank" href="mailto:danieldoblado@gmail.com" data-astro-cid-sz7xmlte>E-Mail</a> <a target="_blank" href="https://github.com/dobladov" data-astro-cid-sz7xmlte>GitHub</a> <a target="_blank" href="https://stackoverflow.com/users/2498992/daniel-doblado" data-astro-cid-sz7xmlte>StackOverflow</a> </footer>  <div class="pattern bottom" data-astro-cid-pj7xj6mf></div> </body></html> <script type="module">const r=document.querySelectorAll("#title, h2, #metadata"),n=new IntersectionObserver(e=>{const c=[...document.querySelectorAll("aside a")];e.forEach(t=>{const s=c.find(i=>i.href.endsWith(`#${t.target.id}`));t.isIntersecting?s?.classList.add("active"):s?.classList.remove("active")})},{threshold:.9});r.forEach(e=>{n.observe(e)});</script>