<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.26125ee9163b7a6830ac.css">.hljs-comment,.hljs-quote{color:#8d8687}.hljs-link,.hljs-meta,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ef6155}.hljs-built_in,.hljs-builtin-name,.hljs-deletion,.hljs-literal,.hljs-number,.hljs-params,.hljs-type{color:#f99b15}.hljs-attribute,.hljs-section,.hljs-title{color:#fec418}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#48b685}.hljs-keyword,.hljs-selector-tag{color:#815ba4}.hljs{display:block;overflow-x:auto;background:#2f1e2e;color:#a39e9b;padding:.5em}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><meta name="generator" content="Gatsby 2.19.17"/><link rel="icon" href="/icons/icon-48x48.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="hsl(180, 3%, 23%)"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b1fee865e2e44db4072b42446d8da506"/><link rel="alternate" type="application/rss+xml" title="Odyssey Codes RSS" href="/rss.xml"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Crawling data from dynamically generated sites - Odyssey Codes</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Text+Me+One&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Let&#x27;s start with the need, why I had the necessity to do this,
Recently I created this  Corona Virus Map , I wanted to be the fastest…"/><meta data-react-helmet="true" property="og:title" content="Crawling data from dynamically generated sites"/><meta data-react-helmet="true" property="author" content="@odysseycodes"/><meta data-react-helmet="true" property="generator" content="Gatsby"/><meta data-react-helmet="true" property="og:description" content="Let&#x27;s start with the need, why I had the necessity to do this,
Recently I created this  Corona Virus Map , I wanted to be the fastest…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@odysseycodes"/><meta data-react-helmet="true" name="twitter:title" content="Crawling data from dynamically generated sites"/><meta data-react-helmet="true" name="twitter:description" content="Let&#x27;s start with the need, why I had the necessity to do this,
Recently I created this  Corona Virus Map , I wanted to be the fastest…"/><link as="script" rel="preload" href="/webpack-runtime-a02b2a4552a4e1f35a50.js"/><link as="script" rel="preload" href="/app-df2e08f97734e3325371.js"/><link as="script" rel="preload" href="/styles-5adfd7646dac4462e70a.js"/><link as="script" rel="preload" href="/commons-7789b0db3f5d7f630efa.js"/><link as="script" rel="preload" href="/component---src-components-posts-js-42333c13e375f9200ca8.js"/><link as="fetch" rel="preload" href="/page-data/blog/crawling-data-from-dynamically-generated sites/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="l5fen9">:root{--main-bg:hsl(0,0%,96%);--main-bg-contrast:hsl(0,0%,94%);--text:hsl(0,0%,24%);--contrast:hsl(154,45%,48%);--important:hsl(5,83%,64%);--subtle:hsl(0,0%,40.8%);}::selection{background-color:var(--contrast);color:white;}html{box-sizing:border-box;}*,*:before,*:after{box-sizing:inherit;}body{background-color:var(--main-bg);color:var(--text);font-size:calc(14px + 0.25vw);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;line-height:1.6;font-weight:300;background-image:url(/static/white-waves-b393837c5f0846824c390132ac12b38f.png);background-attachment:fixed;}body.dark{--main-bg:hsl(0,0%,4%);--main-bg-contrast:hsl(0,0%,7%);--text:hsl(0,0%,100%);background-image:url(/static/cartographer-c809425d3be255bf402057bc2c239f5d.png);}a{font-weight:400;color:var(--text);-webkit-text-decoration-color:var(--contrast);text-decoration-color:var(--contrast);-webkit-text-decoration-thickness:4px;text-decoration-thickness:4px;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none;}a:hover{color:var(--contrast);}.unstyledList{margin:0;padding:0;list-style-type:none;}blockquote{position:relative;font-style:italic;font-size:1.6rem;}blockquote::before{content:"";display:block;position:absolute;width:3px;height:100%;background-color:var(--contrast);left:-15px;top:0;}.hljs{border-radius:5px;font-size:calc(14px + 0.25vw);}.title{font-size:5em;line-height:5.3rem;font-weight:200;margin-top:0;font-family:'Text Me One',sans-serif;grid-area:title;margin:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:20px;}.title svg{margin-right:20px;}.double{display:grid;grid-template-areas:"title title" "article side";grid-template-columns:minmax(200px,2.5fr) minmax(auto,1fr);grid-row-gap:20px;grid-column-gap:60px;}.double .content{max-width:1000px;grid-area:article;font-size:1.4rem;}.double aside{grid-area:side;}.double aside .noLinksDecoration a{-webkit-text-decoration:none;text-decoration:none;}pre{word-wrap:break-word;}@media (max-width:900px){.double{display:block;}.double .title{word-wrap:break-word;font-size:3rem;line-height:3.4rem;}aside{margin-top:50px;}}</style><style data-emotion-css="1t71q3t">.css-1t71q3t{padding:20px 40px;font-family:'Text Me One',sans-serif;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1t71q3t h1{-webkit-flex:1;-ms-flex:1;flex:1;margin:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1t71q3t h1 a{color:var(--text);}.css-1t71q3t .mainNav ul{list-style-type:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;font-size:1.2rem;padding:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1t71q3t .mainNav ul svg{top:6px;position:relative;}.css-1t71q3t .mainNav ul .darkModeBtn{border:none;background-color:transparent;color:var(--text);}.css-1t71q3t .mainNav ul .darkModeBtn:hover{color:var(--contrast);}.css-1t71q3t .mainNav ul a{font-weight:bold;padding:10px;position:relative;}.css-1t71q3t .mainNav ul a.active{color:var(--contrast);-webkit-text-decoration:none;text-decoration:none;}.css-1t71q3t .mainNav ul li{margin-bottom:10px;}.css-1t71q3t .mainNav ul li:first-child a{padding-left:0;}@media (min-width:900px){.css-1t71q3t{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-1t71q3t .mainNav ul li:first-child a{padding-left:10px;}}</style><header class="css-1t71q3t"><h1 style="margin:0"><a title="Home" style="text-decoration:none" href="/">Odyssey Codes</a></h1><nav class="mainNav"><ul role="navigation"><li><a title="Blog Articles" href="/blog">Articles</a></li><li><a title="Personal Projects" href="/projects">Projects</a></li><li><a title="Twitter @odysseycodes" target="_blank" rel="noopener noreferrer" href="https://twitter.com/odysseycodes"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a></li><li><a title="My repositories on GitHub" target="_blank" rel="noopener noreferrer" href="https://github.com/dobladov"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></li><li><a title="Mostly layouts and concepts at CodePen" target="_blank" rel="noopener noreferrer" href="https://codepen.io/dobladov"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2"></polygon><line x1="12" y1="22" x2="12" y2="15.5"></line><polyline points="22 8.5 12 15.5 2 8.5"></polyline><polyline points="2 15.5 12 8.5 22 15.5"></polyline><line x1="12" y1="2" x2="12" y2="8.5"></line></svg></a></li><li><a title="Data visualizations at ObservableHQ" target="_blank" rel="noopener noreferrer" href="https://observablehq.com/@dobladov"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.345 18.922c-.962 0-1.795-.21-2.5-.628a4.242 4.242 0 01-1.62-1.707 9 9 0 01-.826-2.284 12.287 12.287 0 01-.262-2.602c0-.692.045-1.354.137-1.985a9.16 9.16 0 01.501-1.925 6.14 6.14 0 01.94-1.695 4.264 4.264 0 011.507-1.168c.621-.3 1.328-.449 2.123-.449.961 0 1.794.21 2.5.628a4.24 4.24 0 011.62 1.707 8.97 8.97 0 01.825 2.284c.175.804.262 1.672.262 2.603a13.914 13.914 0 01-.136 1.984 8.857 8.857 0 01-.512 1.925 6.5 6.5 0 01-.942 1.696c-.375.479-.875.868-1.494 1.167-.621.3-1.329.449-2.123.449zm1.838-5.31a2.66 2.66 0 00.765-1.911c0-.744-.249-1.382-.746-1.912-.499-.53-1.117-.796-1.857-.796-.741 0-1.36.265-1.859.796a2.696 2.696 0 00-.744 1.912c0 .744.249 1.381.746 1.91.498.532 1.117.797 1.857.797.741 0 1.353-.265 1.838-.796zm-1.838 8.92c5.751 0 10.415-4.85 10.415-10.831C22.76 5.718 18.096.869 12.345.869 6.593.869 1.93 5.719 1.93 11.701c0 5.982 4.663 10.831 10.415 10.831z" stroke="none" fill="currentColor" stroke-width="0"></path></svg></a></li><li><a title="Helping other developers in Stack Overflow" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/2498992/daniel-doblado"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" version="1.1" id="svg12"><style id="style828"></style><path d="M15 17.464H7.32" id="path821" fill="none" stroke-width="2.5" stroke-miterlimit="4" stroke-dasharray="none"></path><path d="M15.173 14.858L7.65 13.31" id="path823" fill="none" stroke-width="2.5" stroke-miterlimit="4" stroke-dasharray="none"></path><path d="M16.007 12.319L8.975 9.234" id="path825" fill="none" fill-opacity="1" stroke-width="2.5" stroke-miterlimit="4" stroke-dasharray="none"></path><path d="M17.485 10.06L11.45 5.31" id="path827" fill="none" stroke-width="2.5" stroke-miterlimit="4" stroke-dasharray="none"></path><path d="M19.475 8.35l-4.693-6.078" id="path829" fill="none" stroke-width="2.5" stroke-miterlimit="4" stroke-dasharray="none"></path><path d="M3.539 14.69v6.255h15.35v-6.052" id="path819" fill="none" stroke-width="2.5" stroke-miterlimit="4" stroke-dasharray="none"></path><style id="style888"></style></svg></a></li><li><a title="E-Mail danieldoblado@gmail.com" href="mailto:danieldoblado@gmail.com"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></li><li><a title="PGP public key: B16C 9712 C6A2 468C ABA4  99BB 9652 C300 6A47 AC0B" href="/public.pgp"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg></a></li><li><a title="Follow my blog articles" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li><li class="noScript"><button aria-label="Toggle dark theme" class="darkModeBtn" title="Use dark theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></li></ul></nav></header><style data-emotion-css="1zm9mk">.css-1zm9mk main{padding:10px 40px;}@media (min-width:900px){.css-1zm9mk main{padding:40px 80px;}}</style><div class="css-1zm9mk"><noscript><style>
              .noScript {
                display: none;
              }

              @media (prefers-color-scheme: dark) {
                body {
                  --main-bg: hsl(0, 0%, 1%);
                  --main-bg-contrast: hsl(0, 0%, 6%);
                  --text: hsl(0, 0%, 100%);
                  background-image: url(/static/cartographer-c809425d3be255bf402057bc2c239f5d.png);
                }
              }
            </style></noscript><main><style data-emotion-css="d8gndv">.css-d8gndv .tags{display:inline-block;}.css-d8gndv .tags li{display:inline-block;}.css-d8gndv .date{font-size:1.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-d8gndv .toc{position:-webkit-sticky;position:sticky;top:100px;}.css-d8gndv .toc ul{padding-left:20px;}.css-d8gndv .contains-task-list{list-style-type:none;padding:0;}.css-d8gndv table{border-spacing:0;border-collapse:collapse;text-align:left;}.css-d8gndv table th,.css-d8gndv table td{padding:6px;border-bottom:.05rem solid var(--text);}.css-d8gndv table th{border-bottom:.05rem solid var(--text);}.css-d8gndv p{text-align:justify;}.css-d8gndv .date,.css-d8gndv .timeToRead,.css-d8gndv .tagsContainer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:10px;}.css-d8gndv .date .icon,.css-d8gndv .timeToRead .icon,.css-d8gndv .tagsContainer .icon{margin-right:10px;}.css-d8gndv .hook{margin-top:0;font-weight:400;text-align:left;font-size:1.5rem;line-height:2rem;margin-bottom:60px;}.css-d8gndv .extra{margin-top:40px;font-size:.9rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}.css-d8gndv h2 a.anchor.before,.css-d8gndv h3 a.anchor.before,.css-d8gndv h4 a.anchor.before,.css-d8gndv h5 a.anchor.before,.css-d8gndv h6 a.anchor.before{stroke:var(--text);position:absolute;left:-40px;padding-left:10px;padding-right:20px;opacity:0;}.css-d8gndv h2 a.anchor.before:focus,.css-d8gndv h3 a.anchor.before:focus,.css-d8gndv h4 a.anchor.before:focus,.css-d8gndv h5 a.anchor.before:focus,.css-d8gndv h6 a.anchor.before:focus{opacity:1;}.css-d8gndv h2:hover a.anchor.before,.css-d8gndv h3:hover a.anchor.before,.css-d8gndv h4:hover a.anchor.before,.css-d8gndv h5:hover a.anchor.before,.css-d8gndv h6:hover a.anchor.before{opacity:1;}</style><section class="double css-d8gndv"><h1 class="title">Crawling data from dynamically generated sites</h1><article class="content"><p class="hook">How to get data from other sites using free online services</p><p>Let’s start with the need, why I had the necessity to do this,
Recently I created this <a href="https://observablehq.com/@dobladov/coronavirus-2019-ncov">Corona Virus Map</a>, I wanted to be the fastest getting the data from the source site in Chinese, most of the other sites get the data periodical using a cron task and dumping their data locally.</p><p>In my case I wanted to get their data every time the map is loaded, ensuring more accurate results and completely avoiding any manual update of data.</p><h2 id="parsing-the-site" style="position:relative"><a href="#parsing-the-site" aria-label="parsing the site permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parsing the site</h2><p>So my first try was to curl the page and sadly the results for this <a href="https://ncov.dxy.cn/ncovh5/view/pneumonia">site</a> will not load unless you use Javascript since the tables are dynamically generated.</p><p>This leave us with not many options but to use a browser, so in my case I decided to use Puppeteer, a headless Chrome browser to get the data.</p><p>So after a while playing with it I got the code to do it, it will download and log the data in the format that I need.</p><pre><code class="hljs language-Javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)
<span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer&#x27;</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.launch()
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.newPage()
  <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&#x27;https://ncov.dxy.cn/ncovh5/view/pneumonia&#x27;</span>)
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> page.evaluate(<span class="hljs-function"><span class="hljs-params">body</span> =&gt;</span> {
    [...document.querySelectorAll(<span class="hljs-string">&quot;.close___2yTiY:not(.open___3it7L)&quot;</span>)].forEach(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e.click())
    <span class="hljs-keyword">return</span> [...document.querySelectorAll(<span class="hljs-string">&#x27;.areaBox___3jZkr&#x27;</span>)[<span class="hljs-number">1</span>].querySelectorAll(<span class="hljs-string">&#x27;.areaBlock2___27vn7&#x27;</span>)].map(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> [area, ,confirmed, dead, cured] = [...row.querySelectorAll(<span class="hljs-string">&#x27;p&#x27;</span>)]
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">area</span>: area.innerText,
        <span class="hljs-attr">confirmed</span>: +confirmed.innerText || <span class="hljs-number">0</span>,
        <span class="hljs-attr">dead</span>: +dead.innerText || <span class="hljs-number">0</span>,
        <span class="hljs-attr">cured</span>: +cured.innerText || <span class="hljs-number">0</span>
      }
    })
  })
  <span class="hljs-built_in">console</span>.log(data)
  fs.writeFileSync(<span class="hljs-string">`2020-02-16T21:21:26.466Z.json`</span>, <span class="hljs-built_in">JSON</span>.stringify(data, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>))
  <span class="hljs-keyword">await</span> browser.close()
})()</code></pre><p>After launching this script with <code>node crawler.js</code> I get a file that I can use as the source data of my visualization.</p><p>All fine but now I have another need, how to get this data every time I load the map?</p><p>For this I definitely need a server running but for this case I wanted to see what can I do with free services.</p><h2 id="using-glitch" style="position:relative"><a href="#using-glitch" aria-label="using glitch permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Glitch</h2><p>My first approach was to use <a href="glitch.com">Glitch</a>, after setting a express server and a few tries later I got my data every time I curl this url: <a href="https://coronacrawler.glitch.me">https://coronacrawler.glitch.me</a></p><pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>)
<span class="hljs-keyword">const</span> app = express()
<span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer&#x27;</span>)

app.use(express.static(<span class="hljs-string">&quot;public&quot;</span>))

app.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.launch({
      <span class="hljs-attr">args</span>: [<span class="hljs-string">&#x27;--no-sandbox&#x27;</span>]
    });

    <span class="hljs-comment">// Same code to get the data before</span>

    res.json(data)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-built_in">console</span>.log(error)
  }
});

<span class="hljs-keyword">const</span> listener = app.listen(process.env.PORT, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Your app is listening on port &quot;</span> + listener.address().port)
})</code></pre><p>Cool, but this creates another problem.</p><h3 id="cross-origin" style="position:relative"><a href="#cross-origin" aria-label="cross origin permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cross-origin</h3><p>The map running in ObservableHQ needs to crawl this data and unfortunately if you curl a different domain from a website it needs to have Cross-origin headers enabled or for security reasons it will not load, after adding this to our express server it works.</p><pre><code class="hljs language-javascript">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
  res.header(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>)
  res.header(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;Origin, X-Requested-With, Content-Type, Accept&quot;</span>)
  next()
})</code></pre><h4 id="alternative-to-cross-origin" style="position:relative"><a href="#alternative-to-cross-origin" aria-label="alternative to cross origin permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alternative to Cross-origin</h4><p>Another solution if adding the headers is impossible (For example in a server we can’t control), we can use a service like <a href="https://cors-anywhere.herokuapp.com/">cors-anywhere</a>, just changing the URL to be:</p><pre><code class="hljs language-bash">https://cors-anywhere.herokuapp.com/https://coronacrawler.glitch.me</code></pre><h4 id="problems-with-glitch" style="position:relative"><a href="#problems-with-glitch" aria-label="problems with glitch permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Problems with Glitch</h4><p>Nice, now I have a server running and I can query the data, what else can I ask for? Well while this works there are two main problems, Glitch is more of a place for playing with code and experimenting so it will not be fast.</p><p>Glitch servers go to sleep, it’s perfectly understandable, it makes no sense for Glitch to give computing power for free running all the time, after some period of inactivity the machine will go to sleep and it needs to be awaken the next time, this makes the map unresponsive if there are not many queries and it gives the sensation of being more slow than it is.</p><p>At this point I moved to zeit.co</p><h2 id="using-zeitco" style="position:relative"><a href="#using-zeitco" aria-label="using zeitco permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Zeit.co</h2><p>Why use zeit.co when Glitch is working?</p><p>This service offers quite a nice free “Hobby” service allowing to use serverless functions.</p><h3 id="creating-a-serverless-function" style="position:relative"><a href="#creating-a-serverless-function" aria-label="creating a serverless function permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a serverless function</h3><p>We need to modify the previous script a little since we have other constrains.</p><p>First we need a start point for the api query in this case we need a file in <code>/api/index.js</code></p><pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> getData = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./getData&#x27;</span>)

<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> getData()
  res.json(data)
}</code></pre><p>The first problem I encountered is that using puppeteer is a little bit different, luckily this guide <a href="https://zeit.co/blog/serverless-chrome">Serverless Chrome via Puppeteer with Now 2.0</a> explains how to do it well.</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> chrome = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chrome-aws-lambda&#x27;</span>)
<span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer-core&#x27;</span>)

<span class="hljs-keyword">const</span> getData = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.launch({
    <span class="hljs-attr">args</span>: chrome.args,
    <span class="hljs-attr">executablePath</span>: <span class="hljs-keyword">await</span> chrome.executablePath,
    <span class="hljs-attr">headless</span>: chrome.headless,
  })

  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.newPage()
  <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&#x27;https://ncov.dxy.cn/ncovh5/view/pneumonia&#x27;</span>)

<span class="hljs-comment">// Same code to get the data before</span>

  <span class="hljs-keyword">return</span> data
}

<span class="hljs-built_in">module</span>.exports = getData</code></pre><h4 id="supporting-cross-origin" style="position:relative"><a href="#supporting-cross-origin" aria-label="supporting cross origin permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Supporting Cross-origin</h4><p>To enable cors we need a file <code>/api/200.js</code></p><pre><code class="hljs language-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> (req, res) =&gt; {
  res.status(<span class="hljs-number">200</span>).send({ <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;cors ok&#x27;</span> });
}</code></pre><p>Also our <code>now.js</code> file should look like this.</p><pre><code class="hljs language-javascript">{
  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-number">2</span>,
  <span class="hljs-string">&quot;routes&quot;</span>: [
    {
      <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;/(.*)&quot;</span>,
      <span class="hljs-string">&quot;dest&quot;</span>: <span class="hljs-string">&quot;/api/index.js&quot;</span>,
      <span class="hljs-string">&quot;headers&quot;</span>: {
        <span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,
        <span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>: <span class="hljs-string">&quot;OPTIONS&quot;</span>,
        <span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>: <span class="hljs-string">&quot;Origin, X-Requested-With, Content-Type, Accept, Authorization&quot;</span>
      }
    }
  ]
}</code></pre><p>After this using the command <code>now</code> should upload the project to zeit.co and the data is available on the project url <a href="https://cvirus.dobladov.now.sh/">https://cvirus.dobladov.now.sh/</a></p><h2 id="notes" style="position:relative"><a href="#notes" aria-label="notes permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Notes</h2><p>As an alternative to Glitch and Zeit we can use <a href="https://docs.netlify.com/functions/overview/#manage-your-serverless-functions">Netlify</a>, but for this project it was not necessary.</p><p>I’m not affiliated to Glitch of Zeit.co in any way, I just think both are really nice services to run my apps.</p><div class="extra"><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a><span>Did I make a mistake? Please consider <a href="https://github.com/dobladov/mdx-blog/edit/master/content/blog/crawling-data-from-dynamically-generated sites.mdx"> sending a pull request</a>.</span></div></article><aside><div class="date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="icon"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>14 February 2020</div><div class="timeToRead"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="icon"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>Time to read: <!-- -->2<!-- --> minutes</div><div class="tagsContainer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><ul class="tags unstyledList"><li><span aria-hidden="true">#</span><a href="/tags/js">js</a>,  </li><li><span aria-hidden="true">#</span><a href="/tags/devops">devops</a>,  </li><li><span aria-hidden="true">#</span><a href="/tags/crawler">crawler</a></li></ul></div><div class="toc noLinksDecoration"><ul role="feed"><li><a rel="toc" href="#parsing-the-site">Parsing the site</a></li><li><a rel="toc" href="#using-glitch">Using Glitch</a><ul role="feed"><li><a rel="toc" href="#cross-origin">Cross-origin</a><ul role="feed"><li><a rel="toc" href="#alternative-to-cross-origin">Alternative to Cross-origin</a></li><li><a rel="toc" href="#problems-with-glitch">Problems with Glitch</a></li></ul></li></ul></li><li><a rel="toc" href="#using-zeitco">Using Zeit.co</a><ul role="feed"><li><a rel="toc" href="#creating-a-serverless-function">Creating a serverless function</a><ul role="feed"><li><a rel="toc" href="#supporting-cross-origin">Supporting Cross-origin</a></li></ul></li></ul></li><li><a rel="toc" href="#notes">Notes</a></li></ul></div></aside></section><a href="#" title="Go Up" aria-hidden="true"><style data-emotion-css="5biiem">.css-5biiem{position:fixed;bottom:20px;right:20px;background-color:var(--main-bg);border-radius:50%;border:1px solid var(--main-bg-contrast);}</style><svg xmlns="http://www.w3.org/2000/svg" width="60px" height="60px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="css-5biiem"><polyline points="17 11 12 6 7 11"></polyline><polyline points="17 18 12 13 7 18"></polyline></svg></a><style data-emotion-css="kvrzot">.css-kvrzot{position:fixed;top:0;left:0;height:4px;background-color:var(--contrast);}</style><div class="progress css-kvrzot" style="width:0"></div></main></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/crawling-data-from-dynamically-generated sites/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-df2e08f97734e3325371.js"],"component---src-components-posts-js":["/component---src-components-posts-js-42333c13e375f9200ca8.js"],"component---src-components-tag-js":["/component---src-components-tag-js-d4c84a68de5829eda535.js"],"component---src-pages-404-js":["/component---src-pages-404-js-fd28f789e4cec3dd4047.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-32ff5ff9447f49228793.js"],"component---src-pages-index-js":["/component---src-pages-index-js-fd3a48c8a1e5feaab892.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-55420780f555204412a8.js"],"component---src-pages-resume-js":["/component---src-pages-resume-js-5973202ada025ca720c5.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-8daa18863338e5e7e06c.js"]};/*]]>*/</script><script src="/component---src-components-posts-js-42333c13e375f9200ca8.js" async=""></script><script src="/commons-7789b0db3f5d7f630efa.js" async=""></script><script src="/styles-5adfd7646dac4462e70a.js" async=""></script><script src="/app-df2e08f97734e3325371.js" async=""></script><script src="/webpack-runtime-a02b2a4552a4e1f35a50.js" async=""></script></body></html>